!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){var r;t.exports=function t(e,i,n){function s(a,l){if(!i[a]){if(!e[a]){var h="function"==typeof r&&r;if(!l&&h)return r(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return s(i||t)},u,u.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof r&&r,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(t,e,i){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,i,r,a,l,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(o(i=this._events[t]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(s(i))for(a=Array.prototype.slice.call(arguments,1),h=i.slice(),r=h.length,l=0;l<r;l++)h[l].apply(this,a);return!0},r.prototype.addListener=function(t,e){var i;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(t,r),i||(i=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},r.prototype.removeListener=function(t,e){var i,r,o,a;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,r=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(i)){for(a=o;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){r=a;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,i){var r,n,s,o,a;a=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),r=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],s="ie"===r[1]&&document.documentMode,(n={name:"version"===r[1]?r[3]:r[1],version:s||parseFloat("opera"===r[1]&&r[4]?r[4]:r[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[n.name]=!0,n[n.name+parseInt(n.version,10)]=!0,n.platform[n.platform.name]=!0,e.exports=n},{}],3:[function(t,e,i){var r,n,s,o={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},l=[].slice;r=t("events").EventEmitter,s=t("./browser.coffee"),n=function(t){var e,i;function r(t){var i,r,n;for(r in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),e)n=e[r],null==(i=this.options)[r]&&(i[r]=n)}return function(t,e){for(var i in e)o.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(r,t),e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},i={delay:500,copy:!1},r.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},r.prototype.setOptions=function(t){var e,i,r;for(e in i=[],t)o.call(t,e)&&(r=t[e],i.push(this.setOption(e,r)));return i},r.prototype.addFrame=function(t,e){var r,n;for(n in null==e&&(e={}),(r={}).transparent=this.options.transparent,i)r[n]=e[n]||i[n];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!==ImageData&&t instanceof ImageData)r.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?r.data=this.getContextData(t):r.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?r.data=this.getImageData(t):r.image=t}return this.frames.push(r)},r.prototype.render=function(){var t,e,i;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,i;for(i=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)i.push(null);return i}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,i=e;0<=i?t<i:t>i;0<=i?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},r.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)this.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},r.prototype.spawnWorkers=function(){var t,e,i,r;return t=Math.min(this.options.workers,this.frames.length),function(){i=[];for(var r=e=this.freeWorkers.length;e<=t?r<t:r>t;e<=t?r++:r--)i.push(r);return i}.apply(this).forEach((r=this,function(t){var e;return r.log("spawning worker "+t),(e=new Worker(r.options.workerScript)).onmessage=function(t){return r.activeWorkers.splice(r.activeWorkers.indexOf(e),1),r.freeWorkers.push(e),r.frameFinished(t.data)},r.freeWorkers.push(e)})),t},r.prototype.frameFinished=function(t){var e,i;if(this.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!0===this.options.globalPalette&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,i=this.freeWorkers.length;1<=i?e<i:e>i;1<=i?++e:--e)this.renderNextFrame();return a.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},r.prototype.finishRendering=function(){var t,e,i,r,n,s,o,a,l,h,c,u,d,f,p,g;for(a=0,f=this.imageParts,n=0,l=f.length;n<l;n++)e=f[n],a+=(e.data.length-1)*e.pageSize+e.cursor;for(a+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),t=new Uint8Array(a),u=0,p=this.imageParts,s=0,h=p.length;s<h;s++)for(e=p[s],g=e.data,i=o=0,c=g.length;o<c;i=++o)d=g[i],t.set(d,u),i===e.data.length-1?u+=e.cursor:u+=e.pageSize;return r=new Blob([t],{type:"image/gif"}),this.emit("finished",r,t)},r.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e)},r.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},r.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},r.prototype.getTask=function(t){var e,i;if(e=this.frames.indexOf(t),i={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===s.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},r.prototype.log=function(){var t;if(t=1<=arguments.length?l.call(arguments,0):[],this.options.debug)return console.log.apply(console,t)},r}(r),e.exports=n},{"./browser.coffee":2,events:1}]},{},[3])(3)},function(t,e,i){var r;!function t(e,i,n){function s(a,l){if(!i[a]){if(!e[a]){if(!l&&("function"==typeof r&&r))return r(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){var i=e[a][1][t];return s(i||t)},c,c.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof r&&r,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(t,e,i){var r=t("./TypedNeuQuant.js"),n=t("./LZWEncoder.js");function s(){this.page=-1,this.pages=[],this.newPage()}s.pageSize=4096,s.charMap={};for(var o=0;o<256;o++)s.charMap[o]=String.fromCharCode(o);function a(t,e){this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new s}s.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(s.pageSize),this.cursor=0},s.prototype.getData=function(){for(var t="",e=0;e<this.pages.length;e++)for(var i=0;i<s.pageSize;i++)t+=s.charMap[this.pages[e][i]];return t},s.prototype.writeByte=function(t){this.cursor>=s.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=t},s.prototype.writeUTFBytes=function(t){for(var e=t.length,i=0;i<e;i++)this.writeByte(t.charCodeAt(i))},s.prototype.writeBytes=function(t,e,i){for(var r=i||t.length,n=e||0;n<r;n++)this.writeByte(t[n])},a.prototype.setDelay=function(t){this.delay=Math.round(t/10)},a.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},a.prototype.setDispose=function(t){t>=0&&(this.dispose=t)},a.prototype.setRepeat=function(t){this.repeat=t},a.prototype.setTransparent=function(t){this.transparent=t},a.prototype.addFrame=function(t){this.image=t,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),!0===this.globalPalette&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.globalPalette||this.writePalette(),this.writePixels(),this.firstFrame=!1},a.prototype.finish=function(){this.out.writeByte(59)},a.prototype.setQuality=function(t){t<1&&(t=1),this.sample=t},a.prototype.setDither=function(t){!0===t&&(t="FloydSteinberg"),this.dither=t},a.prototype.setGlobalPalette=function(t){this.globalPalette=t},a.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},a.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},a.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new r(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace("-serpentine",""),null!==this.dither.match(/-serpentine/)):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent,!0))},a.prototype.indexPixels=function(t){var e=this.pixels.length/3;this.indexedPixels=new Uint8Array(e);for(var i=0,r=0;r<e;r++){var n=this.findClosestRGB(255&this.pixels[i++],255&this.pixels[i++],255&this.pixels[i++]);this.usedEntry[n]=!0,this.indexedPixels[r]=n}},a.prototype.ditherPixels=function(t,e){var i={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!t||!i[t])throw"Unknown dithering kernel: "+t;var r=i[t],n=0,s=this.height,o=this.width,a=this.pixels,l=e?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var h=0;h<s;h++){e&&(l*=-1);for(var c=1==l?0:o-1,u=1==l?o:0;c!==u;c+=l){var d=3*(n=h*o+c),f=a[d],p=a[d+1],g=a[d+2];d=this.findClosestRGB(f,p,g),this.usedEntry[d]=!0,this.indexedPixels[n]=d,d*=3;for(var m=f-this.colorTab[d],v=p-this.colorTab[d+1],y=g-this.colorTab[d+2],w=1==l?0:r.length-1,b=1==l?r.length:0;w!==b;w+=l){var x=r[w][1],S=r[w][2];if(x+c>=0&&x+c<o&&S+h>=0&&S+h<s){var M=r[w][0];d=n+x+S*o,a[d*=3]=Math.max(0,Math.min(255,a[d]+m*M)),a[d+1]=Math.max(0,Math.min(255,a[d+1]+v*M)),a[d+2]=Math.max(0,Math.min(255,a[d+2]+y*M))}}}}},a.prototype.findClosest=function(t,e){return this.findClosestRGB((16711680&t)>>16,(65280&t)>>8,255&t,e)},a.prototype.findClosestRGB=function(t,e,i,r){if(null===this.colorTab)return-1;if(this.neuQuant&&!r)return this.neuQuant.lookupRGB(t,e,i);for(var n=0,s=16777216,o=this.colorTab.length,a=0,l=0;a<o;l++){var h=t-(255&this.colorTab[a++]),c=e-(255&this.colorTab[a++]),u=i-(255&this.colorTab[a++]),d=h*h+c*c+u*u;(!r||this.usedEntry[l])&&d<s&&(s=d,n=l)}return n},a.prototype.getImagePixels=function(){var t=this.width,e=this.height;this.pixels=new Uint8Array(t*e*3);for(var i=this.image,r=0,n=0,s=0;s<e;s++)for(var o=0;o<t;o++)this.pixels[n++]=i[r++],this.pixels[n++]=i[r++],this.pixels[n++]=i[r++],r++},a.prototype.writeGraphicCtrlExt=function(){var t,e;this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),null===this.transparent?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=7&dispose),e<<=2,this.out.writeByte(0|e|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},a.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},a.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},a.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},a.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=768-this.colorTab.length,e=0;e<t;e++)this.out.writeByte(0)},a.prototype.writeShort=function(t){this.out.writeByte(255&t),this.out.writeByte(t>>8&255)},a.prototype.writePixels=function(){new n(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this.out)},a.prototype.stream=function(){return this.out},e.exports=a},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(t,e,i){var r=-1,n=12,s=5003,o=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=function(t,e,i,a){var l,h,c,u,d,f,p=Math.max(2,a),g=new Uint8Array(256),m=new Int32Array(s),v=new Int32Array(s),y=0,w=0,b=!1;function x(t,e){g[h++]=t,h>=254&&k(e)}function S(t){M(s),w=d+2,b=!0,E(d,t)}function M(t){for(var e=0;e<t;++e)m[e]=-1}function k(t){h>0&&(t.writeByte(h),t.writeBytes(g,0,h),h=0)}function L(t){return(1<<t)-1}function C(){return 0===remaining?r:(--remaining,255&i[curPixel++])}function E(t,e){for(l&=o[y],y>0?l|=t<<y:l=t,y+=n_bits;y>=8;)x(255&l,e),l>>=8,y-=8;if((w>c||b)&&(b?(c=L(n_bits=u),b=!1):(++n_bits,c=n_bits==n?1<<n:L(n_bits))),t==f){for(;y>0;)x(255&l,e),l>>=8,y-=8;k(e)}}this.encode=function(i){i.writeByte(p),remaining=t*e,curPixel=0,function(t,e){var i,o,a,l,p,g,y;for(u=t,b=!1,n_bits=u,c=L(n_bits),f=1+(d=1<<t-1),w=d+2,h=0,l=C(),y=0,i=s;i<65536;i*=2)++y;y=8-y,M(g=s),E(d,e);t:for(;(o=C())!=r;)if(i=(o<<n)+l,m[a=o<<y^l]!==i){if(m[a]>=0){p=g-a,0===a&&(p=1);do{if((a-=p)<0&&(a+=g),m[a]===i){l=v[a];continue t}}while(m[a]>=0)}E(l,e),l=o,w<1<<n?(v[a]=w++,m[a]=i):S(e)}else l=v[a];E(l,e),E(f,e)}(p+1,i),i.writeByte(0)}}},{}],3:[function(t,e,i){var r=100,n=256,s=n-1,o=4,a=16,l=1<<a,h=10,c=10,u=l>>c,d=l<<h-c,f=6,p=(n>>3)*(1<<f),g=30,m=1024,v=256,y=1<<18,w=499,b=491,x=487,S=503,M=3*S;e.exports=function(t,e){var i,k,L,C,E;function P(t,e,r,n,s){i[e][0]-=t*(i[e][0]-r)/m,i[e][1]-=t*(i[e][1]-n)/m,i[e][2]-=t*(i[e][2]-s)/m}function B(t,e,r,s,o){for(var a,l,h=Math.abs(e-t),c=Math.min(e+t,n),u=e+1,d=e-1,f=1;u<c||d>h;)l=E[f++],u<c&&((a=i[u++])[0]-=l*(a[0]-r)/y,a[1]-=l*(a[1]-s)/y,a[2]-=l*(a[2]-o)/y),d>h&&((a=i[d--])[0]-=l*(a[0]-r)/y,a[1]-=l*(a[1]-s)/y,a[2]-=l*(a[2]-o)/y)}function _(t,e,r){var s,l,f,p,g,m=~(1<<31),v=m,y=-1,w=y;for(s=0;s<n;s++)l=i[s],(f=Math.abs(l[0]-t)+Math.abs(l[1]-e)+Math.abs(l[2]-r))<m&&(m=f,y=s),(p=f-(L[s]>>a-o))<v&&(v=p,w=s),g=C[s]>>c,C[s]-=g,L[s]+=g<<h;return C[y]+=u,L[y]-=d,w}this.buildColormap=function(){!function(){var t,e;for(i=[],k=new Int32Array(256),L=new Int32Array(n),C=new Int32Array(n),E=new Int32Array(n>>3),t=0;t<n;t++)e=(t<<o+8)/n,i[t]=new Float64Array([e,e,e,0]),C[t]=l/n,L[t]=0}(),function(){var i,n,s,a,l,h,c=t.length,u=30+(e-1)/3,d=c/(3*e),y=~~(d/r),k=m,L=p,C=L>>f;for(C<=1&&(C=0),i=0;i<C;i++)E[i]=k*((C*C-i*i)*v/(C*C));c<M?(e=1,n=3):n=c%w!=0?3*w:c%b!=0?3*b:c%x!=0?3*x:3*S;var T=0;for(i=0;i<d;)if(P(k,h=_(s=(255&t[T])<<o,a=(255&t[T+1])<<o,l=(255&t[T+2])<<o),s,a,l),0!==C&&B(C,h,s,a,l),(T+=n)>=c&&(T-=c),0===y&&(y=1),++i%y==0)for(k-=k/u,(C=(L-=L/g)>>f)<=1&&(C=0),h=0;h<C;h++)E[h]=k*((C*C-h*h)*v/(C*C))}(),function(){for(var t=0;t<n;t++)i[t][0]>>=o,i[t][1]>>=o,i[t][2]>>=o,i[t][3]=t}(),function(){var t,e,r,o,a,l,h=0,c=0;for(t=0;t<n;t++){for(a=t,l=(r=i[t])[1],e=t+1;e<n;e++)(o=i[e])[1]<l&&(a=e,l=o[1]);if(o=i[a],t!=a&&(e=o[0],o[0]=r[0],r[0]=e,e=o[1],o[1]=r[1],r[1]=e,e=o[2],o[2]=r[2],r[2]=e,e=o[3],o[3]=r[3],r[3]=e),l!=h){for(k[h]=c+t>>1,e=h+1;e<l;e++)k[e]=t;h=l,c=t}}for(k[h]=c+s>>1,e=h+1;e<256;e++)k[e]=s}()},this.getColormap=function(){for(var t=[],e=[],r=0;r<n;r++)e[i[r][3]]=r;for(var s=0,o=0;o<n;o++){var a=e[o];t[s++]=i[a][0],t[s++]=i[a][1],t[s++]=i[a][2]}return t},this.lookupRGB=function(t,e,r){for(var s,o,a,l=1e3,h=-1,c=k[e],u=c-1;c<n||u>=0;)c<n&&((a=(o=i[c])[1]-e)>=l?c=n:(c++,a<0&&(a=-a),(s=o[0]-t)<0&&(s=-s),(a+=s)<l&&((s=o[2]-r)<0&&(s=-s),(a+=s)<l&&(l=a,h=o[3])))),u>=0&&((a=e-(o=i[u])[1])>=l?u=-1:(u--,a<0&&(a=-a),(s=o[0]-t)<0&&(s=-s),(a+=s)<l&&((s=o[2]-r)<0&&(s=-s),(a+=s)<l&&(l=a,h=o[3]))));return h}}},{}],4:[function(t,e,i){var r,n;r=t("./GIFEncoder.js"),n=function(t){var e,i,n,s;return e=new r(t.width,t.height),0===t.index?e.writeHeader():e.firstFrame=!1,e.setTransparent(t.transparent),e.setRepeat(t.repeat),e.setDelay(t.delay),e.setQuality(t.quality),e.setDither(t.dither),e.setGlobalPalette(t.globalPalette),e.addFrame(t.data),t.last&&e.finish(),!0===t.globalPalette&&(t.globalPalette=e.getGlobalPalette()),n=e.stream(),t.data=n.pages,t.cursor=n.cursor,t.pageSize=n.constructor.pageSize,t.canTransfer?(s=function(){var e,r,n,s;for(s=[],e=0,r=(n=t.data).length;e<r;e++)i=n[e],s.push(i.buffer);return s}(),self.postMessage(t,s)):self.postMessage(t)},self.onmessage=function(t){return n(t.data)}},{"./GIFEncoder.js":1}]},{},[4])},function(t,e,i){var r,n,s;n=[],void 0===(s="function"==typeof(r=function(){return function t(e,i,r){var n,s,o=window,a="application/octet-stream",l=r||a,h=e,c=!i&&!r&&h,u=document.createElement("a"),d=function(t){return String(t)},f=o.Blob||o.MozBlob||o.WebKitBlob||d,p=i||"download";if(f=f.call?f.bind(o):Blob,"true"===String(this)&&(l=(h=[h,l])[0],h=h[1]),c&&c.length<2048&&(p=c.split("/").pop().split("?")[0],u.href=c,-1!==u.href.indexOf(c))){var g=new XMLHttpRequest;return g.open("GET",c,!0),g.responseType="blob",g.onload=function(e){t(e.target.response,p,a)},setTimeout(function(){g.send()},0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(h)){if(!(h.length>2096103.424&&f!==d))return navigator.msSaveBlob?navigator.msSaveBlob(w(h),p):b(h);h=w(h),l=h.type||a}else if(/([\x80-\xff])/.test(h)){for(var m=0,v=new Uint8Array(h.length),y=v.length;m<y;++m)v[m]=h.charCodeAt(m);h=new f([v],{type:l})}function w(t){for(var e=t.split(/[:;,]/),i=e[1],r=t.indexOf("charset")>0?3:2,n="base64"==e[r]?atob:decodeURIComponent,s=n(e.pop()),o=s.length,a=0,l=new Uint8Array(o);a<o;++a)l[a]=s.charCodeAt(a);return new f([l],{type:i})}function b(t,e){if("download"in u)return u.href=t,u.setAttribute("download",p),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",u.addEventListener("click",function(t){t.stopPropagation(),this.removeEventListener("click",arguments.callee)}),document.body.appendChild(u),setTimeout(function(){u.click(),document.body.removeChild(u),!0===e&&setTimeout(function(){o.URL.revokeObjectURL(u.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var i=document.createElement("iframe");document.body.appendChild(i),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),i.src=t,setTimeout(function(){document.body.removeChild(i)},333)}if(n=h instanceof f?h:new f([h],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(n,p);if(o.URL)b(o.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===d)try{return b("data:"+l+";base64,"+o.btoa(n))}catch(t){return b("data:"+l+","+encodeURIComponent(n))}(s=new FileReader).onload=function(t){b(this.result)},s.readAsDataURL(n)}return!0}})?r.apply(e,n):r)||(t.exports=s)},function(t,e,i){"use strict";i.r(e);class r{constructor(t,e){this.database=t,this.state={currentTool:""},this.cursorColor="",this.sizeModificator=5,this.fps=10,this.framesArray=[]}setFps(t){this.fps=t}getFps(){return this.fps}setFrames(t){this.framesArray.push(t)}getFrames(){return this.framesArray}getFramesLength(){return this.framesArray.length}setState(t){this.state.currentTool=t}getState(t){return console.log(this.state.currentTool),this.state.currentTool}setCursorColor(t){this.cursorColor=t}getCursorColor(){return this.cursorColor}setSizeModificator(t){this.sizeModificator=t}getSizeModificator(){return this.sizeModificator}localStorage(t,e){let i=(t=>{let e=document.createElement("canvas");return e.width=120,e.height=120,e.getContext("2d").drawImage(t,0,0),e.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")})(t);localStorage.setItem("imgData",i),localStorage.setItem("canvas",e.toDataURL()),this.canvas=localStorage.getItem(e)}init(){let t=localStorage.getItem("imgData"),e=document.getElementById("frames"),i=document.createElement("img");i.src=`data:image/png;base64,${t}`,e.appendChild(i),console.log(i)}}class n{constructor(t){this.preview=t,this.frameTarget=document.querySelector("#frames"),this.coordinatesTarget=document.querySelector("#canvas-coordinates"),this.gifTarget=document.querySelector(".images")}dataToImage(t){const e=t.toDataURL(),i=document.createElement("img");return i.src=e,i.style.width="100px",i.style.height="100px",i}render(t){const e=document.createElement("div");e.style.border="1px solid black",e.style.marginBottom="5px",e.classList.add("frame"),e.appendChild(t),this.frameTarget.appendChild(e)}renderCoords(t,e){this.coordinatesTarget.innerHTML=`<p>x:${t} y:${e}</p>`}}var s=(t,e)=>{const i=t.getBoundingClientRect();return{x:Math.round(e.clientX-i.left),y:Math.round(e.clientY-i.top)}};i(0),i(1),i(2);const o=document.getElementById("canvas"),a=o.getContext("2d");class l{constructor(t,e){this.mainModel=t,this.appView=e,this.penBtn=document.querySelector("#pen"),this.createFrameBtn=document.querySelector("#createFrameBtn"),this.eraserBtn=document.querySelector("#eraser"),this.lineBtn=document.querySelector("#line"),this.cursorColorBtn=document.querySelector("#cursorColor"),this.circleBtn=document.querySelector("#circle"),this.fillRectagnleBtn=document.querySelector("#fill-rectangle"),this.strokeRectangleBtn=document.querySelector("#stroke-rectangle"),this.fillCircleBtn=document.querySelector("#fill-circle"),this.strokeCircleBtn=document.querySelector("#stroke-circle"),this.btn32=document.querySelector("#btn32"),this.btn64=document.querySelector("#btn64"),this.btn128=document.querySelector("#btn128"),this.fpsBtn=document.querySelector("#fps-btn"),this.btn32.addEventListener("click",()=>{o.width=32,o.height=32,this.mainModel.setSizeModificator(20)}),this.btn64.addEventListener("click",()=>{o.width=64,o.height=64,this.mainModel.setSizeModificator(10)}),this.btn128.addEventListener("click",()=>{o.width=128,o.height=128,this.mainModel.setSizeModificator(5)}),this.fpsBtn.addEventListener("change",t=>{t.preventDefault(),this.mainModel.setFps(this.fpsBtn.value)}),o.addEventListener("mousemove",t=>{this.appView.renderCoords(Math.floor(s(o,t).x/this.getSize()),Math.floor(s(o,t).y/this.getSize()))}),document.addEventListener("keypress",t=>{"q"===t.key&&(this.mainModel.setState("pen"),this.pen()),"e"===t.key&&(this.mainModel.setState("drawLine"),this.drawLine()),"r"===t.key&&(this.mainModel.setState("fillRectangle"),this.fillRectangle()),"r"===t.key&&(this.mainModel.setState("fillRectangle"),this.fillRectangle()),"t"===t.key&&(this.mainModel.setState("strokeRectangle"),this.strokeRectangle()),"y"===t.key&&(this.mainModel.setState("fillCircle"),this.fillCircle()),"u"===t.key&&(this.mainModel.setState("strokeCircle"),this.strokeCircle()),"z"===t.key&&(this.mainModel.setState("erase"),this.erase())}),this.penBtn.addEventListener("click",()=>{this.mainModel.setState("pen"),this.pen()}),this.eraserBtn.addEventListener("click",()=>{this.mainModel.setState("erase"),this.erase()}),this.lineBtn.addEventListener("click",()=>{this.mainModel.setState("drawLine"),this.drawLine()}),this.fillRectagnleBtn.addEventListener("click",()=>{this.mainModel.setState("fillRectangle"),this.fillRectangle()}),this.strokeRectangleBtn.addEventListener("click",()=>{this.mainModel.setState("strokeRectangle"),this.strokeRectangle()}),this.fillCircleBtn.addEventListener("click",()=>{this.mainModel.setState("fillCircle"),this.fillCircle()}),this.strokeCircleBtn.addEventListener("click",()=>{this.mainModel.setState("strokeCircle"),this.strokeCircle()}),this.createFrameBtn.addEventListener("click",this.createFrame()),this.cursorColorBtn.addEventListener("change",()=>{this.mainModel.setCursorColor(this.cursorColorBtn.value),console.log(this.cursorColorBtn.value)})}getSize(){return this.mainModel.getSizeModificator()}pen(){let t=!1;a.beginPath(),o.addEventListener("mousemove",e=>{const i=this.mainModel.getCursorColor();a.fillStyle=i,a.strokeStyle=i,"pen"===this.mainModel.state.currentTool?(o.addEventListener("mousedown",()=>{"pen"===this.mainModel.state.currentTool&&(t=!0)}),o.addEventListener("mouseup",()=>{"pen"===this.mainModel.state.currentTool&&(t=!1,a.beginPath())}),t&&(a.lineTo(Math.floor(s(o,e).x/this.getSize()),Math.floor(s(o,e).y/this.getSize())),a.stroke(),a.lineWidth=1,a.beginPath(),a.moveTo(Math.floor(s(o,e).x/this.getSize()),Math.floor(s(o,e).y/this.getSize())))):(o.removeEventListener("mousemove",this),o.removeEventListener("mousedown",this),o.removeEventListener("mouseup",this))})}drawLine(){o.addEventListener("mousedown",t=>{"drawLine"===this.mainModel.state.currentTool&&(a.beginPath(),a.moveTo(s(o,t).x/this.getSize(),s(o,t).y/this.getSize()))}),o.addEventListener("mouseup",t=>{if("drawLine"===this.mainModel.state.currentTool){const e=this.mainModel.getCursorColor();a.fillStyle=e,a.strokeStyle=e,a.lineTo(s(o,t).x/this.getSize(),s(o,t).y/this.getSize()),a.lineWidth=1,a.strokeStyle=e,a.stroke(),a.beginPath()}})}erase(){o.addEventListener("mousemove",t=>{"erase"===this.mainModel.state.currentTool&&(a.fillStyle="#fff",a.beginPath(),a.rect(s(o,t).x/this.getSize(),s(o,t).y/this.getSize(),5,5),a.fill())})}fillRectangle(){let t,e,i,r,n;t=e=0,r=n=0,i=!1,a.beginPath(),o.addEventListener("mousedown",r=>{"fillRectangle"===this.mainModel.state.currentTool&&(t=Math.floor(s(o,r).x/this.getSize()),e=Math.floor(s(o,r).y/this.getSize()),i=!0)}),o.addEventListener("mouseup",t=>{"fillRectangle"===this.mainModel.state.currentTool&&(i=!1,a.beginPath())}),o.addEventListener("mousemove",l=>{if("fillRectangle"===this.mainModel.state.currentTool&&(r=Math.floor(s(o,l).x/this.getSize()),n=Math.floor(s(o,l).y/this.getSize()),i)){a.beginPath();const i=r-t,s=n-e;a.rect(t,e,i,s),a.fillStyle=this.mainModel.getCursorColor(),a.lineWidth=1,a.fill()}})}strokeRectangle(){let t,e,i,r,n;t=e=0,r=n=0,i=!1,a.beginPath(),o.addEventListener("mousedown",r=>{"strokeRectangle"===this.mainModel.state.currentTool&&(t=Math.floor(s(o,r).x/this.getSize()),e=Math.floor(s(o,r).y/this.getSize()),i=!0)}),o.addEventListener("mouseup",t=>{"strokeRectangle"===this.mainModel.state.currentTool&&(i=!1,a.fillStyle="#fff",a.fill(),a.beginPath())}),o.addEventListener("mousemove",l=>{if("strokeRectangle"===this.mainModel.state.currentTool&&(r=Math.floor(s(o,l).x/this.getSize()),n=Math.floor(s(o,l).y/this.getSize()),i)){const i=r-t,s=n-e;a.rect(t,e,i,s),a.strokeStyle=this.mainModel.getCursorColor(),a.lineWidth=1,a.stroke()}})}fillCircle(){let t,e,i,r,n;t=e=0,r=n=0,i=!1,a.beginPath(),o.addEventListener("mousedown",r=>{"fillCircle"===this.mainModel.state.currentTool&&(t=Math.floor(s(o,r).x/this.getSize()),e=Math.floor(s(o,r).y/this.getSize()),i=!0)}),o.addEventListener("mouseup",t=>{"fillCircle"===this.mainModel.state.currentTool&&(i=!1,a.beginPath())}),o.addEventListener("mousemove",l=>{if("fillCircle"===this.mainModel.state.currentTool&&(r=Math.floor(s(o,l).x/this.getSize()),n=Math.floor(s(o,l).y/this.getSize()),i)){a.beginPath();const i=parseInt(r-t-(n-e)/2);a.arc(t,e,Math.abs(i),0,2*Math.PI),a.fillStyle=this.mainModel.getCursorColor(),a.lineWidth=1,a.fill()}})}strokeCircle(){let t,e,i,r,n;t=e=0,r=n=0,i=!1,a.beginPath(),o.addEventListener("mousedown",r=>{"strokeCircle"===this.mainModel.state.currentTool&&(t=Math.floor(s(o,r).x/this.getSize()),e=Math.floor(s(o,r).y/this.getSize()),i=!0)}),o.addEventListener("mouseup",t=>{"strokeCircle"===this.mainModel.state.currentTool&&(i=!1,a.fillStyle="#fff",a.fill(),a.beginPath())}),o.addEventListener("mousemove",l=>{if("strokeCircle"===this.mainModel.state.currentTool&&(r=Math.floor(s(o,l).x/this.getSize()),n=Math.floor(s(o,l).y/this.getSize()),i)){a.beginPath();const i=parseInt(r-t-(n-e)/2);a.arc(t,e,Math.abs(i),0,2*Math.PI),a.strokeStyle=this.mainModel.getCursorColor(),a.lineWidth=1,a.stroke()}})}createFrame(){const t=document.getElementById("animation");let e=0;const i=()=>{clearInterval(r);const n=this.mainModel.getFrames(),s=n[e];e<n.length?(t.innerHTML=`<img src="${s.src}"></img>`,e++):e=0,r=setInterval(i,1e3/this.mainModel.getFps())};let r=setInterval(i,1e3/this.mainModel.getFps());document.querySelector("#createFrameBtn").addEventListener("mouseup",t=>{t.preventDefault();const e=this.appView.dataToImage(o);this.appView.render(e),this.mainModel.setFrames(e),this.mainModel.getFrames()})}}(new class{start(){const t=new r;t.init();const e=new n;new l(t,e)}}).start()}]);
//# sourceMappingURL=app.bundle.js.map